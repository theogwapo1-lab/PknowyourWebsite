<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pknow Your Memes</title>
  <meta name="description" content="A minimal single-file HTML timeline showcasing the origin and evolution of Philippine memes from 2010 to 2025." />
  <style>
    #tagNav button {
  text-transform: capitalize;
}
    :root{
      --bg:#fafafa; --card:#ffffff; --accent:#0b5cff; --muted:#6b7280; --maxw:1100px;
      --radius:10px; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif,sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#111;display:flex;justify-content:center;padding:28px}
    .wrap{width:100%;max-width:var(--maxw)}

    header{display:flex;align-items:center;gap:16px;margin-bottom:20px;justify-content:space-between}
    .logo{width:160px;height:160px;border-radius:12px;object-fit:cover;display:block}
    /* small author photo placed top-right */
    .author-photo {
  width: 60px;           /* smaller width */
  height: 60px;          /* smaller height */
  border-radius: 8px;    /* rounded corners */
  object-fit: cover;     /* keeps proportions */
  flex-shrink: 0;        /* prevents squishing */
  margin-top: 2px;       /* aligns better with text */
}

.author-inline {
  display: flex;
  align-items: flex-start;   /* aligns photo and text at the top */
  gap: 12px;                 /* space between photo and text */
  flex-wrap: wrap;           /* allows text to wrap neatly on smaller screens */
  max-width: 450px;          /* compact width */
}

.author-photo {
  width: 60px;
  height: 60px;
  border-radius: 8px;
  object-fit: cover;
  flex-shrink: 0;            /* prevents photo from shrinking */
}

.author-info {
  flex: 1;
  min-width: 200px;
  word-wrap: break-word;
  line-height: 1.4;
}

.author-bio {
  color: var(--muted);
  font-size: 12px;
  margin: 4px 0;
}

.author-email {
  color: var(--accent);
  text-decoration: none;
  font-weight: 600;
  word-break: break-word;
}
.filter-btn.clear {
  background-color: #f44336;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: background-color 0.3s;
}

.filter-btn.clear:hover {
  background-color: #d32f2f;
}

.author-email:hover {
  text-decoration: underline;
}

    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    nav.years{display:flex;flex-wrap:wrap;gap:8px;margin:18px 0}
    .year-btn{background:transparent;border:1px solid #e6e9ef;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
    .year-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}

    .controls{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .search{flex:1}
    input[type=search]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
    .card{background:var(--card);border-radius:var(--radius);padding:12px;border:1px solid #c4bdbd;display:flex;flex-direction:column;gap:8px}
    .thumb{width:100%;height:160px;object-fit:cover;border-radius:8px;background:#f3f4f6}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .title{font-weight:700}
    .origin{font-size:12px;color:var(--muted)}
    .tags{display:flex;flex-wrap:wrap;gap:6px}
    .tag{font-size:11px;padding:6px 8px;border-radius:7px;background:#f2f7ff;color:var(--accent)}
    .link-btn{display:inline-block;margin-top:8px;padding:6px 8px;border-radius:7px;background:#f2f7ff;color:var(--accent);text-decoration:none;font-size:12px;border:1px solid rgba(11,92,255,0.08)}
    main{margin-top:10px}
    footer{margin-top:px;color:var(--muted);font-size:13px}

    /* Modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:20px}
    .modal.open{display:flex;background:rgba(0,0,0,0.45)}
    .modal-card{width:100%;max-width:1100px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.12)}
    /* Modal layout: left = caption + preview, right = player */
  .modal-grid{display:grid;grid-template-columns:320px 1fr;gap:18px;align-items:start}
  .modal-thumb{width:100%;height:auto;max-height:480px;object-fit:cover;border-radius:8px}
  .left-col{display:flex;flex-direction:column;gap:12px}
  .right-col{display:flex;align-items:flex-start;justify-content:center}
  #mPlayer{width:100%;} 
  /* make embed area match preview height and take remaining width */
  .embed-container{position:relative;width:100%;min-height:360px;overflow:hidden;border-radius:8px;background:#000}
  .embed-container::before{content:"";display:block;padding-top:56.25%} /* preserves 16:9 ratio */
  .embed-container > iframe,
  .embed-container > video,
  .embed-container > div{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
  @media (max-width:1000px){
    .modal-grid{grid-template-columns:1fr}
    .modal-thumb{height:200px;max-height:200px}
    .embed-container{min-height:200px}
  }

    /* print-friendly */
    @media print{body{background:#fff} .controls,.year-btn{display:none}}

    /* small helper */
    .muted{color:var(--muted)}

    /* Add to your existing styles */
.embed-container {
  position: relative;
  width: 100%;
  height: 100%;
  min-height: var(--player-height, 320px);
  background: #000;
  border-radius: 8px;
  overflow: hidden;
}

.embed-container iframe,
.embed-container video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100% !important;  /* force full width */
  height: 100% !important; /* force full height */
  border: 0;
}

.modal-grid {
  display: grid;
  gap: 20px;
  grid-template-columns: var(--modal-cols, 320px 1fr);
  align-items: start;
}

/* Ensure right column player fills space */
.right-col .embed-container {
  min-height: var(--modal-player-height, 540px);
}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <div style="display:flex;align-items:center;gap:16px">
        <img src="./image/Logo.png" alt="PK Logo" class="logo">
        <div class="brand">
          <h1>Pknow Your Memes</h1>
          <p class="lead">A Website Dedicated to Archiving Filipino Internet Humor, Pop Culture, and Lost Media.</p>
        </div>
      </div>
      <div class="author-inline" aria-labelledby="aboutTitle">
  <img src="./image/theo.jpg" alt="Theo Jan Joseph" class="author-photo" />
  <div class="author-info">
    <div class="author-name" id="aboutTitle">Theo Jan Joseph</div>
    <p class="author-bio">For Fun and Historical Records Timeline</p>
    <p class="author-bio">
      You can email me at tmdanao@up.edu.ph if you want something removed, any corrections, or to contribute.
    </p>
    <p class="author-bio">
  <a href="contributors.html" class="author-email">View Contributors →</a>
  </p>
  </div>
</div>

    </header>

    <div class="controls">
      <div class="search">
        <p class="author-bio">Disclaimer: some data may not be 100% accuarate and I would appreciate it if you give me insights.</p>
        <label for="q" class="muted" style="display:none">Search</label>
        <input id="q" type="search" placeholder="Search meme title, tag, or origin" />
    
      </div>
      <div>
        <button id="clear" class="year-btn">Show all</button>
      </div>
    </div>
<div class="filter-controls">
  <button id="clearFilters" class="filter-btn clear">Clear Filters</button>
  <p class="author-bio">
      Remember to Always Clear Filters
</div>

    <nav class="years" aria-label="Filter by year" id="yearNav"></nav>
<nav class="tags" aria-label="Filter by tag" id="tagNav" style="margin-top:10px;"></nav>

    <main>
      <section id="timeline" class="grid" aria-live="polite"></section>
    </main>

    <footer>
      Report dead links or suggest memes to add
    </footer>
  </div>

  <!-- modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <button class="close" id="modalClose" aria-label="Close">✕</button>

      <div class="modal-grid">
        <!-- LEFT: caption / tags / description on top, then preview photo -->
        <div class="left-col">
          <div class="caption">
            <h2 id="mTitle"></h2>
            <p class="muted" id="mOrigin"></p>
            <div id="mMetaTop" style="margin-top:8px"></div>
            <p id="mDesc" style="margin-top:8px"></p>
          </div>

          <img id="mImg" class="modal-thumb" alt="meme image" />
        </div>

        <!-- RIGHT: player area (embeds appear here) -->
        <div class="right-col">
          <div id="mPlayer"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_PH/sdk.js#xfbml=1&version=v17.0"></script>

  <script>
    // ====== DATA: add real meme objects here (title, year, origin, image, description, tags)
    // For images, use relative paths or hosted URLs. Keep the page single-file by using base64 if desired.
    const MEMES = [
  {
    title: 'I love you virus',
    year: 2000,
    image: './image/iloveyou.jpg',
    embedUrl: 'https://www.youtube.com/watch?v=tHUi04CwSFk',
    link: 'https://www.cnet.com/tech/services-and-software/history-of-the-iloveyou-virus/',
    news: 'https://www.bbc.com/news/technology-52458765',
    origin: 'Onel de Guzman',
    profile: '',
    description: 'I think it is best to start with Onel De Guzman because he was a major figure for Filipino Internet presence',
    tags: ['news', 'criminal', 'Legend']
  },
  {
    title: 'Kween Yasmin Peace Sign',
    year: 2023,
    embedUrl: 'https://www.youtube.com/embed/4OIQLxhhVMc?start=25',
    image: './image/kweenyasmin.jpg',
    link: 'https://youtu.be/4OIQLxhhVMc?si=9C6Ro7w1YMrTnahJ&t=25',
    profile: 'https://www.facebook.com/www.facebookyasminasistido.090',
    origin: 'Yasmin Marie M. Asistido',
    description: 'Kween Yasmin nag Pepeace Sign'
  },
  {
    title: 'Komikero',
    year: 2009,
    embedUrl: 'https://www.youtube.com/embed/bhuYIr1J1zc',
    image: './image/komikero.webp',
    link: 'https://www.youtube.com/watch?si=1rUlyHi4dUW9nsBh&v=bhuYIr1J1zc&feature=youtu.be',
    profile: 'https://en.wikipedia.org/wiki/Gerry_Alanguilan',
    origin: 'Doroteo Gerardo N. Alanguilan Jr.',
    description: 'Hey Baby, meron akong museum sa San Pablo, Laguna. Punta ka!',
    tags: ['ancient']
  },
  {
    title: 'Kapeng matapang',
    year: 2019,
    image: './image/Kapengmatapang.jpg',
    link: 'https://www.facebook.com/reel/1383634471776415',
    profile: 'https://www.facebook.com/reniebhoycjovellanos.jovellanos',
    origin: 'Renie Bhoy Jovellano',
    description: 'Aeouaueoueu',
    styles: {
      thumbnail: {
        height: '180px',
        objectFit: 'cover'
      },
      player: {
        width: '360px',        // fixed player width for vertical reel
        maxWidth: '360px',
        height: '500px',       // fixed height to match 9:16 vertical
        aspectRatio: '9/16',
        margin: '0 auto',
        display: 'block'
      },
      modal: {
        width: '720px',        // wider modal for vertical video
        maxHeight: '90vh',
        columnRatio: '0/1',    // collapse left column, video takes full modal width
        playerHeight: '640px'  // informs layout and left-column scroll height
      }
    }
  },
  {
    title: 'Friendzone Logo',
    year: 2016,
    embedUrl: 'https://www.youtube.com/embed/0cT78evUJbQ',
    image: './image/friendzone.jpg',
    link: 'https://www.bbc.com/news/blogs-trending-37363350',
    profile: 'httpsyoutu.be/0cT78evUJbQ?si=Ggc-jDfqK081yJFS',
    origin: 'Heart and Like',
    description: 'Friendzone logo meme — origin and context',
    tags: ['origin']
  },
  {
    title: 'Caloocan Boy',
    year: 2021,
    embedUrl: 'https://www.youtube.com/embed/0cT78evUJbQ',
    image: './image/caloocanboy.jpg',
    link: 'https://www.facebook.com/photo/?fbid=101011348779108&set=pcb.101011408779102',
    profile: 'https://www.tiktok.com/@benjiepader29',
    song: 'https://www.youtube.com/watch?v=DUmcisXhahQ&list=RDDUmcisXhahQ&start_radio=1',
    origin: 'Benjie Mallillin Pader',
    description: 'Eh Paano kung',
    tags: ['urban legend'],
  },
  {
    title: 'Harry Roque Boracay',
    year: 2020,
    embedUrl: 'https://www.youtube.com/embed/ganSYJCOVrM?start=12',
    image: './image/harryroque.png',
    link: 'https://youtu.be/ganSYJCOVrM?si=x1TpaXdW_W_J-upZ&t=12',
    origin: 'Boracay',
    description: 'Harry Roque served as a spokesperson of Rodrigo Dutwink Boy',
    tags: ['politics']
  },
  {
    title: 'Zoom Call Vico Sotto',
    year: 2020,
    news: 'https://inquirersuper.com.ph/trending/someones-thirst-trap-zoom-background-interrupted-a-forum-with-mayor-vico-sotto-and-it-was-hilarious/',
    video: 'https://x.com/MisterFantasty/status/1252927489082441731',
    image: './image/vicosotto.jpg',
    origin: 'Vico Sotto',
    description: 'Zoom call interrupted by a humorous background during Mayor Vico Sotto’s forum',
    tags: ['politics']
  },
  {
    title: 'Astig Cap and Super Lola',
    year: 2025,
    news: 'https://www.rappler.com/entertainment/celebrities/dennis-padilla-posts-daughter-claudia-wedding/',
    video: 'https://www.reddit.com/r/ChikaPH/comments/1jx6m23/dennis_gift_for_claudia_and_basti_is_his_astig/?tl=en',
    image: './image/dennis.png',
    origin: 'Dennis Padilla',
    description: 'Hangkulet',
    tags: ['celebrity']
  },
  {
    title: 'Cringe Covid Dance',
    year: 2020,
    news: 'https://www.esquiremag.ph/politics/news/covid-dance-number-mascot-a00293-20200817',
    video: 'https://youtu.be/ohFruCubxs0?si=zckxpaMAALoZYA9O&t=70',
    embedUrl: 'https://www.youtube.com/embed/ohFruCubxs0?start=70',
    image: './image/Coviddance.png',
    origin: '',
    description: 'Corona Lumayo ka! Di ka namin lalapitan! Medjo lalayo sa kapwa!',
    tags: ['politics', 'dance']
  },
  {
    title: 'Milktea Burger tsaka Fries',
    year: 2020,
    embedUrl: 'https://www.facebook.com/watch/?v=239443514191792',
    image: './image/Burgermilktea.jpg',
    link: 'https://www.facebook.com/watch/?v=239443514191792',
    profile: 'https://www.tiktok.com/@joretinoy?lang=en',
    origin: '@queenlinaloudaot',
    description: 'Sana all Sinusuyo',
    tags: ['tiktok', 'urban legend'],styles: {
      thumbnail: {
        height: '180px',
        objectFit: 'cover'
      },
      player: {
        width: '360px',        // fixed player width for vertical reel
        maxWidth: '360px',
        height: '500px',       // fixed height to match 9:16 vertical
        aspectRatio: '9/16',
        margin: '0 auto',
        display: 'block'
      },
      modal: {
        width: '720px',        // wider modal for vertical video
        maxHeight: '90vh',
        columnRatio: '0/1',    // collapse left column, video takes full modal width
        playerHeight: '640px'  // informs layout and left-column scroll height
      }
    }
  },
  {
    title: 'Binay Ash Wednesday',
    year: 2016,
    embedUrl: 'https://www.youtube.com/embed/ganSYJCOVrM?start=12',
    image: './image/binay.jpg',
    link: 'https://www.pep.ph/news/12/jejomar-binay-reacts-to-ash-wednesday-memes-part-of-the-job-e',
    origin: 'Jejomar Binay',
    description: 'Jejomar "Jojo" Cabauatan Binay Sr. is a Filipino lawyer and politician who served as the 13th Vice President of the Philippines from 2010 to 2016.',
    tags: ['politics']
  },
  {
    title: 'N-word Binay',
    year: 2020,
    embedUrl: 'https://www.youtube.com/embed/ganSYJCOVrM?start=12',
    image: './image/nancy.png',
    link: 'https://newsinfo.inquirer.net/1213399/n-word-abby-binay-receives-offensive-messages-for-not-suspending-classes',
    origin: '',
    description: 'Maria Lourdes Nancy Sombillo Binay Angeles is a Filipino politician who is serving as the 22nd mayor of Makati since June 30, 2025. She previously served as a senator of the Philippines from 2013 to 2025. Binay is the daughter of former Vice President Jejomar Binay.',
    tags: ['politics']
  },
  {
    title: 'Jovit the Basketball',
    year: 2020,
    embedUrl: 'https://www.youtube.com/embed/ganSYJCOVrM?start=12',
    image: './image/jovit.jpg',
    link: 'https://pop.inquirer.net/99825/jovit-baldivino-unhappy-with-the-memes-of-him-playing-basketball',
    origin: '2011 throwback photo',
    description: 'However, it seems that Jovit is unhappy with the memes when he replied to a fan through Messenger saying “di kayo nakakatuwa” with a smiley emoji.',
    tags: ['celebrity', 'sports']
  },
  {
    title: 'Immortal Enrile',
    year: 2020,
    embedUrl: 'https://www.youtube.com/embed/ganSYJCOVrM?start=12',
    image: './image/enrile.jpg',
    news: 'https://www.spin.ph/life/people/immortal-enrile-surfaces-on-social-media-but-not-as-a-meme-a1374-20200329',
    video: 'https://x.com/krisponcenrile/status/1243755017770655744',
    origin: 'Enrile meme circulated in 2020 as a joking COVID-era relic; character traces to older folklore.',
    tags: ['politics']
  },
  {
    title: 'Pipoy Como',
    year: 2020,
    embedUrl: 'https://www.tiktok.com/@pipoycomo/video/6843691465021902081',
    image: './image/Pipoy.png',
    link: 'https://www.tiktok.com/@pipoycomo/video/6843691465021902081',
    profile: 'https://www.tiktok.com/@pipoycomo',
    origin: '',
    description: 'ewan ko ba parang tarantado lang',
    tags: ['urban legend', 'tiktok'],styles: {
      
      thumbnail: {
        height: '180px',
        objectFit: 'cover'
      },
      player: {
        width: '100%',
        height: 'auto',
        aspectRatio: '8/12'
      },
      modal: {
        width: '600px',
        maxHeight: '600px',
        columnRatio: '40/60',
        aspectRatio: '8/12'
    }
  }
  },
  {
    title: 'Darwin Lim',
    year: 2020,
    image: './image/darwin.jpeg',
    link: 'https://www.tiktok.com/@inggopogi25/video/6883795382950841601?lang=en',
    profile: 'https://www.tiktok.com/@inggopogi25?lang=en',
    origin: 'Doombringer',
    description: 'ewan ko rin parang tarantadao din (1)',
    tags: ['urban legend', 'tiktok'],
   styles: {
      
      thumbnail: {
        height: '180px',
        objectFit: 'cover'
      },
      player: {
        width: '100%',
        height: 'auto',
        aspectRatio: '8/12'
      },
      modal: {
        width: '600px',
        maxHeight: '600px',
        columnRatio: '40/60',
        aspectRatio: '8/12'
    }
  }
  },
  {
    title: 'Ako lang ba guys?',
    year: 2020,
    image: './image/rakim.jpg',
    link: 'https://www.youtube.com/watch?v=m_tXHULdPmI',
    profile: 'https://www.tiktok.com/@rakimsantos_?lang=en',
    origin: 'Rakim Santos',
    description: '',
    tags: ['urban legend', 'tiktok']
  },
  {
    title: 'Langgaw sa toes ko',
    year: 2020,
    image: './image/langgaw.jpg',
    link: 'https://www.tiktok.com/@valerie1999.50/video/7028533750313094426',
    profile: 'https://www.tiktok.com/@valerie1999.50',
    origin: 'Valerie Mae Cruz',
    description: 'Hi guys, so kanina kasi nagphotoshoot kami ng pamangkin ko grabe sobrang laughtrip ng result and super laughtrip kasi may dumikit na langaw sa toes ko... tingnan nyo. Ito po yung result diba sobrang ganda diba pero when you look closely sa pinakababa ng paa ko, sa toes ko may dumikit na langaw. Wait lang zoom in ko. Ayan po guys nakita nyo ba guys dyan sa pinakalower left side guys kita nyo ba yung langaw laughtrip sya guys oh kita nyo ba ayan oh di ko maturo pano ba to gamiting greenscreen na to ayan ayan laughtrip. Like bakit may langaw???!!! Sarap na sarap kang langaw ka ah',
    tags: ['tiktok'],
    styles: {
      
      thumbnail: {
        height: '180px',
        objectFit: 'cover'
      },
      player: {
        width: '100%',
        height: 'auto',
        aspectRatio: '8/12'
      },
      modal: {
        width: '1000px',
        maxHeight: '600px',
        columnRatio: '40/60',
        aspectRatio: '6/12'
    }
  }
  },
 
  {
    title: 'Jhepoy Dizon',
    year: 2013,
    image: './image/jepoy.WEBP',
    link: 'https://youtube.fandom.com/wiki/KapKek',
    video: 'https://youtu.be/SzOWy1o2dTA?si=k2Qdgd6mJilJfZ8g',
    profile: 'https://www.youtube.com/@ShupetGaming',
    origin: 'John Alfred Richards Tejero',
    description: 'TANGINA MO, JHEPOY DIZON! ANG PANGIT NG PAGMUMUKHA MO, KITA MO NA BANG MUKHA MO SA SALAMIN? TANGINA MO! ANG PANGIT MO, HA? Tangina mo! At anong ang sinasabi mong pulubi at taga-hugas ako ng pinggan ha? TANGINA MO!',
    tags: ['games']
  },
  {
    title: 'Happy NewYear Ebriwan',
    year: 2015,
    image: './image/happynewyear.jpg',
    link: 'https://www.facebook.com/MannyPacquiao/videos/1512832759020745/?extid=CL-UNK-UNK-UNK-IOS_GK0T-GK1C&ref=sharing',
    profile: '',
    origin: 'Manny Pacquiao',
    description: '',
    tags: ['celebrity'],
    styles: {
      
      thumbnail: {
        height: '180px',
        objectFit: 'cover'
      },
     player: {
        width: '100%',
        height: 'auto',
    modal: {
    width: '900px',          
    maxHeight: '90vh',       
    columnRatio: '45/55',    
    aspectRatio: '16/9'      
  }
  }
  }
  }
];


    function createYouTubePlayer(videoId, container) {
  if (!window.YT) {
    // Load YouTube API if not already loaded
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  }

  return new YT.Player(container, {
    height: '315',
    width: '100%',
    videoId: videoId,
    playerVars: {
      autoplay: 1,
      modestbranding: 1,
      rel: 0
    }
  });
}

    const YEARS = [];
    for(let y=1999;y<=2025;y++) YEARS.push(y);

    const el = {
      yearNav:document.getElementById('yearNav'),
      timeline:document.getElementById('timeline'),
      q:document.getElementById('q'),
      clear:document.getElementById('clear'),
      modal:document.getElementById('modal'),
      modalClose:document.getElementById('modalClose'),
      mTitle:document.getElementById('mTitle'),
      mOrigin:document.getElementById('mOrigin'),
      mDesc:document.getElementById('mDesc'),
      mImg:document.getElementById('mImg'),
      mMetaTop:document.getElementById('mMetaTop'), // changed
      mPlayer:document.getElementById('mPlayer')    // added
    };

    let activeYear = null;

    function renderYears(){
      el.yearNav.innerHTML = '';
      YEARS.forEach(y=>{
        const btn = document.createElement('button');
        btn.textContent = y;
        btn.className = 'year-btn';
        btn.addEventListener('click',()=>{ setYearFilter(y,btn); });
        el.yearNav.appendChild(btn);
      });
    }

    function setYearFilter(y,btn){
      activeYear = y;
      document.querySelectorAll('.year-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      renderTimeline();
    }

    function clearYear(){
      activeYear = null;
      document.querySelectorAll('.year-btn').forEach(b=>b.classList.remove('active'));
      renderTimeline();
    }

    function createCard(m) {
      const c = document.createElement('article');
      c.className = 'card';
      c.tabIndex = 0;
      
      // Apply custom card styles if defined
      if (m.styles?.card) {
        Object.assign(c.style, m.styles.card);
      }

      const img = document.createElement('img');
      img.className = 'thumb';
      img.loading = 'lazy';
      img.src = m.image;
      img.alt = m.title;
      
      // Apply custom thumbnail styles
      if (m.styles?.thumbnail) {
        Object.assign(img.style, m.styles.thumbnail);
      }

      const t = document.createElement('div');
      t.innerHTML = `<div class="meta"><div>
          <div class="title">${escapeHtml(m.title)}</div>
          <div class="origin">${m.year} · ${escapeHtml(m.origin)}</div>
        </div></div>`;

      // optional external links (won't trigger modal)
      const links = [];
      if(m.link) links.push({ href: m.link, text: 'Source' });
      if(m.song) links.push({ href: m.song, text: 'Song' });
      if(m.video) links.push({ href: m.video, text: 'Video' });
      if(m.news) links.push({ href: m.news, text: 'News' });
      if(m.profile) links.push({ href: m.profile, text: 'Profile' });
      links.forEach(l=>{
        const a = document.createElement('a');
        a.className = 'link-btn';
        a.href = l.href;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.textContent = l.text;
        // prevent card click from also opening modal
        a.addEventListener('click', (e) => e.stopPropagation());
        t.appendChild(a);
      });

      const tags = document.createElement('div');
      tags.className = 'tags';
      (m.tags||[]).slice(0,4).forEach(tag=>{
        const s = document.createElement('span'); s.className='tag'; s.textContent = tag; tags.appendChild(s);
      });

      c.appendChild(img);
      c.appendChild(t);
      c.appendChild(tags);

      c.addEventListener('click',()=>openModal(m));
      c.addEventListener('keydown',(e)=>{ if(e.key==='Enter') openModal(m); });
      return c;
    }

    function renderTimeline(){
      const q = el.q.value.trim().toLowerCase();
      const list = MEMES.filter(m=>{
        if (activeYear && m.year !== activeYear) return false;
if (activeTag && !(m.tags || []).includes(activeTag)) return false;
        if(!q) return true;
        const hay = (m.title+' '+m.origin+' '+(m.tags||[]).join(' ')+ ' ' + m.description).toLowerCase();
        return hay.includes(q);
      });
      el.timeline.innerHTML = '';
      if(list.length===0){ el.timeline.innerHTML = '<p class="muted">No memes found — try clearing filters or add entries to the data array.</p>'; return }
      list.forEach(m=> el.timeline.appendChild(createCard(m)) );
    }

    // add helper to reliably render Facebook embeds (retry XFBML.parse then fallback to plugins iframe)
function renderFacebookEmbed(container, fbUrl, playerStyle = {}) {
  if (!fbUrl || !container) return;

  // Clear previous content
  container.innerHTML = '';

  // create sized wrapper that embed will fill
  const wrapper = document.createElement('div');
  wrapper.className = 'embed-container';

  // determine height from playerStyle or modal CSS var
  let height = (playerStyle && (playerStyle.height || playerStyle.playerHeight)) || '';
  if (!height) {
    const modalCard = container.closest('.modal-card');
    if (modalCard) {
      const cssH = getComputedStyle(modalCard).getPropertyValue('--modal-player-height') || '';
      if (cssH) height = cssH.trim();
    }
  }
  if (!height) height = '360px';
  // normalize simple numeric values to px
  if (/^\d+$/.test(String(height).trim())) height = height + 'px';
  wrapper.style.minHeight = height;

  // create iframe pointing to Facebook plugins video (fills wrapper)
  const encoded = encodeURIComponent(fbUrl);
  const iframe = document.createElement('iframe');
  iframe.src = `https://www.facebook.com/plugins/video.php?href=${encoded}&show_text=false&autoplay=true`;
  iframe.style.width = '100%';
  iframe.style.height = '100%';
  iframe.style.border = '0';
  iframe.allow = 'autoplay; encrypted-media; picture-in-picture';
  iframe.allowFullscreen = true;

  wrapper.appendChild(iframe);
  container.appendChild(wrapper);
}

// Replace your openModal with this version that shows the modal BEFORE rendering FB embeds
function openModal(m) {
  el.mTitle.textContent = m.title || '';
  el.mOrigin.textContent = (m.year || '') + (m.origin ? ' · ' + m.origin : '');
  el.mDesc.textContent = m.description || '';
  el.mImg.src = m.image || '';

  el.mMetaTop.innerHTML = '';
  el.mPlayer.innerHTML = '';

  if (m.tags && m.tags.length) {
    el.mMetaTop.innerHTML = '<div class="tags">' +
      m.tags.map(t => `<span class="tag">${t}</span>`).join('') +
      '</div>';
  }

  // Apply modal sizing
  const modalCard = el.modal.querySelector('.modal-card');
  const modalGrid = el.modal.querySelector('.modal-grid');
  modalCard.style.removeProperty('--modal-max-height');
  modalCard.style.removeProperty('--modal-player-height');
  modalCard.style.removeProperty('--modal-cols');
  modalCard.style.width = '';
  if (m.styles?.modal) {
    const md = m.styles.modal;
    if (md.maxHeight) modalCard.style.setProperty('--modal-max-height', md.maxHeight);
    if (md.playerHeight) modalCard.style.setProperty('--modal-player-height', md.playerHeight);
    if (md.width) modalCard.style.width = md.width;
    if (md.columnRatio) {
      if (md.columnRatio.includes('/')) {
        const [l, r] = md.columnRatio.split('/');
        modalCard.style.setProperty('--modal-cols', `${l}fr ${r}fr`);
        modalGrid.style.gridTemplateColumns = `${l}fr ${r}fr`;
      } else {
        modalCard.style.setProperty('--modal-cols', md.columnRatio);
        modalGrid.style.gridTemplateColumns = md.columnRatio;
      }
    }
  }

  // Make modal visible BEFORE inserting FB node or parsing SDK
  el.modal.classList.add('open');
  el.modal.setAttribute('aria-hidden', 'false');

  const source = m.embedUrl || m.video || m.link;
  const info = getEmbedInfo(source);

  if (info && info.type === 'facebook') {
    // ensure we call renderFacebookEmbed after modal visible
    renderFacebookEmbed(el.mPlayer, info.embedUrl, m.styles?.player);
  } else if (info && info.type === 'video' && info.embedUrl) {
    const player = document.createElement('div');
    player.className = 'embed-container';
    const p = m.styles?.player || {};
    if (p.maxWidth) player.style.maxWidth = p.maxWidth;
    if (p.width) player.style.width = p.width;
    if (p.height) {
      player.style.minHeight = (String(p.height).match(/px|vh|%/) ? p.height : (p.height + 'px'));
      modalCard.style.setProperty('--modal-player-height', player.style.minHeight);
    }
    if (p.margin) player.style.margin = p.margin;

    const iframe = document.createElement('iframe');
    iframe.src = info.embedUrl;
    iframe.frameBorder = '0';
    iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    iframe.allowFullscreen = true;
    iframe.style.width = '100%';
    iframe.style.height = '100%';

    const closeBtn = document.createElement('button');
    closeBtn.className = 'close-embed';
    closeBtn.textContent = 'Close Player';
    closeBtn.style.marginTop = '10px';
    closeBtn.addEventListener('click', () => player.remove());

    player.appendChild(iframe);
    el.mPlayer.appendChild(player);
    el.mPlayer.appendChild(closeBtn);
  } else {
    if (source) {
      const linkDiv = document.createElement('div');
      linkDiv.className = 'modal-links';
      const a = document.createElement('a');
      a.href = source;
      a.className = 'link-btn';
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = 'Open Source';
      linkDiv.appendChild(a);
      el.mPlayer.appendChild(linkDiv);
    }
  }

  // links rendering...
  const links = [];
  if (m.link) links.push({ href: m.link, text: 'Source' });
  if (m.video) links.push({ href: m.video, text: 'Video' });
  if (m.embedUrl && (!m.video || m.embedUrl !== m.video)) links.push({ href: m.embedUrl, text: 'Embed' });
  if (m.profile) links.push({ href: m.profile, text: 'Profile' });
  if (m.news) links.push({ href: m.news, text: 'News' });
  if (m.song) links.push({ href: m.song, text: 'Song' });

  if (links.length) {
    const seen = new Set();
    const linksDiv = document.createElement('div');
    linksDiv.className = 'modal-links';
    links.forEach(l => {
      try {
        if (!l.href) return;
        const key = String(l.href).trim();
        if (seen.has(key)) return;
        seen.add(key);
        const a = document.createElement('a');
        a.href = l.href;
        a.className = 'link-btn';
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.textContent = l.text;
        a.addEventListener('click', e => e.stopPropagation());
        linksDiv.appendChild(a);
      } catch (err) {}
    });
    el.mPlayer.appendChild(linksDiv);
  }

  if (!m.styles?.thumbnail?.height) {
    el.mImg.style.maxHeight = '240px';
  } else {
    el.mImg.style.maxHeight = m.styles.thumbnail.height;
  }
}

    // make sure close removes any players inside right column
    function closeModal() {
      el.mPlayer.innerHTML = '';
      el.modal.classList.remove('open');
      el.modal.setAttribute('aria-hidden', 'true');
    }

    el.modal.addEventListener('click',(e)=>{ if(e.target === el.modal) closeModal(); });
    el.modalClose.addEventListener('click',closeModal);
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeModal(); });

    el.q.addEventListener('keydown',(e)=>{ if(e.key==='Enter') renderTimeline(); });
    el.clear.addEventListener('click',()=>{ el.q.value=''; clearYear(); });

    // escape HTML for safety (simple)
    function escapeHtml(str){ return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// ==== TAG FILTERS ====
const elTagNav = document.getElementById('tagNav');
let activeTag = null;

function getAllTags() {
  const all = new Set();
  MEMES.forEach(m => (m.tags || []).forEach(t => all.add(t)));
  return Array.from(all).sort();
}

function renderTags() {
  elTagNav.innerHTML = '';
  getAllTags().forEach(tag => {
    const btn = document.createElement('button');
    btn.textContent = tag;
    btn.className = 'year-btn'; // reuse button style
    btn.addEventListener('click', () => {
      activeTag = (activeTag === tag ? null : tag);
      document.querySelectorAll('#tagNav .year-btn').forEach(b => b.classList.remove('active'));
      
      if (activeTag) btn.classList.add('active');
      renderTimeline();
    });
    elTagNav.appendChild(btn);
  });

  // Clear Filters button logic
document.addEventListener("DOMContentLoaded", () => {
  const clearFiltersBtn = document.getElementById("clearFilters");
  if (!clearFiltersBtn) return; // in case button not yet added

  clearFiltersBtn.addEventListener("click", () => {
    // Reset active filters
    activeYear = null;
    activeTag = null;

    // Remove active states from buttons
    document.querySelectorAll(".year-btn, .tag-btn").forEach(btn => {
      btn.classList.remove("active");
    });

    // Refresh UI
    renderTimeline();
    renderTags();
  });
});

}
    renderTags();
    
    // initial render
    renderYears(); renderTimeline();

    // Expose simple helper to add new meme entries from browser console
    window._MemeAdmin = {
      add(m){ MEMES.push(m); renderTimeline(); return m; },
      all(){ return MEMES; }
    };

    // Replace the old getEmbedUrl with this helper that returns {embedUrl, type}
// type === 'video' -> safe to render iframe player
// type === 'link'  -> not a video (just provide link)
// null             -> unknown / unsupported
function getEmbedInfo(url) {
  if (!url) return null;
  const s = String(url).trim();

  try {
    // YouTube
    const yt = s.match(/(?:youtube\.com\/(?:watch\?(?:.*&)?v=|embed\/)|youtu\.be\/)([A-Za-z0-9_-]{11})/i);
    if (yt && yt[1]) {
      return { embedUrl: `https://www.youtube-nocookie.com/embed/${yt[1]}?autoplay=1&rel=0`, type: 'video' };
    }

    // TikTok
    const tt = s.match(/tiktok\.com\/.*\/video\/(\d+)/i);
    if (tt && tt[1]) {
      return { embedUrl: `https://www.tiktok.com/embed/v2/${tt[1]}`, type: 'video' };
    }

    // Facebook - preserve the original URL and mark as facebook so we render via FB SDK
    if (/facebook\.com|fb\.watch/i.test(s)) {
      return { embedUrl: s, type: 'facebook' };
    }

    // Reddit
    if (/reddit\.com|redd\.it/i.test(s)) {
      try {
        const u = new URL(s);
        if (u.pathname.includes('/comments/')) {
          return { embedUrl: `https://www.redditmedia.com${u.pathname}embed`, type: 'video' };
        }
      } catch (e) {}
      return { embedUrl: s, type: 'link' };
    }

    // Vimeo
    const vimeo = s.match(/vimeo\.com\/(?:video\/)?(\d+)/i);
    if (vimeo && vimeo[1]) {
      return { embedUrl: `https://player.vimeo.com/video/${vimeo[1]}`, type: 'video' };
    }

    // Generic http link -> treat as link
    if (/^https?:\/\//i.test(s)) {
      return { embedUrl: s, type: 'link' };
    }
  } catch (err) {
    console.warn('getEmbedInfo parse error', err);
  }
  return null;
}
  </script>
</body>
</html>
